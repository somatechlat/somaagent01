# Simplified Dockerfile that fixes all architectural issues
FROM python:3.11-slim

# Set environment variables
ENV PYTHONPATH=/a0:/a0/common:/a0/python:/a0/services
ENV PATH="/venv/bin:${PATH}"

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    git \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# Create virtual environment
RUN python -m venv /venv

# Copy requirements and install Python dependencies
COPY requirements-core.txt /tmp/
RUN /venv/bin/pip install --no-cache-dir -r /tmp/requirements-core.txt

# Install additional required packages
RUN /venv/bin/pip install --no-cache-dir \
    supervisor \
    jsonschema \
    "langchain<0.2"

# Create working directory
WORKDIR /a0

# Expose ports
EXPOSE 80 8010 8015 8016 20017

# Default command
CMD ["python3", "-c", "print('Container ready')"]