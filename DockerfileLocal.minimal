# Minimal Dockerfile for fast development
FROM agent0ai/agent-zero-base:latest

# Set environment
ENV PYTHONPATH=/git/agent-zero
ENV PATH="/venv/bin:${PATH}"

# Copy ALL essential agent files
COPY ./python/ /git/agent-zero/python/
COPY ./services/ /git/agent-zero/services/
COPY ./common/ /git/agent-zero/common/
COPY ./conf/ /git/agent-zero/conf/
COPY ./prompts/ /git/agent-zero/prompts/
COPY ./webui/ /git/agent-zero/webui/
COPY ./run_ui.py /git/agent-zero/
COPY ./agent.py /git/agent-zero/
COPY ./models.py /git/agent-zero/
COPY ./initialize.py /git/agent-zero/
COPY ./preload.py /git/agent-zero/
COPY ./prepare.py /git/agent-zero/

# Install python3-venv and create venv
RUN apt-get update && apt-get install -y python3-venv python3-pip && \
    python3 -m venv /venv && \
    /venv/bin/pip install --upgrade pip && \
    /venv/bin/pip install --no-cache-dir \
        fastapi==0.115.2 \
        uvicorn[standard]==0.32.0 \
        pydantic==2.11.6 \
        redis==5.2.0 \
        aiokafka==0.11.0 \
        fasta2a==0.5.0 \
        fastmcp==2.3.4 \
        mcp==1.13.1 \
        python-dotenv==1.1.0 \
        PyYAML==6.0.2 \
        httpx==0.28.1 \
        Flask==3.0.3 \
        "langchain<0.2" \
        psycopg[binary]==3.2.3 \
        asyncpg==0.29.0 \
        grpcio==1.67.1 \
        protobuf==5.27.3 && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Verify critical imports
RUN /venv/bin/python -c "import fasta2a, fastmcp, mcp; print('SUCCESS: Critical packages installed')"

EXPOSE 80 8010 20017
CMD ["/venv/bin/python", "run_ui.py", "--dockerized=true", "--host=0.0.0.0", "--port=80"]