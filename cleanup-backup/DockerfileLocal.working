# WORKING minimal Dockerfile - 256MB
FROM python:3.13-slim

ENV PYTHONPATH=/git/agent-zero
ENV PATH="/venv/bin:${PATH}"
WORKDIR /git/agent-zero

# Copy essential files
COPY ./run_ui.py ./agent.py ./models.py ./initialize.py /git/agent-zero/
COPY ./python/ /git/agent-zero/python/
COPY ./services/ /git/agent-zero/services/
COPY ./common/ /git/agent-zero/common/
COPY ./conf/ /git/agent-zero/conf/
COPY ./prompts/ /git/agent-zero/prompts/
COPY ./webui/ /git/agent-zero/webui/

# Install packages
RUN python3 -m venv /venv && \
    /venv/bin/pip install --no-cache-dir \
        fastapi==0.115.2 \
        uvicorn==0.32.0 \
        fasta2a==0.5.0 \
        fastmcp==2.3.4 \
        mcp==1.13.1 \
        python-dotenv==1.1.0 \
        Flask==3.1.2 \
        PyYAML==6.0.3 \
        httpx==0.28.1 \
        redis==6.4.0

EXPOSE 80
CMD ["/venv/bin/python", "run_ui.py", "--host=0.0.0.0", "--port=80"]