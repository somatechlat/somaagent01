{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://somaagent01.dev/schemas/audit/settings_write_diff.v1.schema.json",
  "title": "Settings Write Diff (v1)",
  "description": "Masked before/after diff for settings writes (UI sections and related state). No raw secrets allowed.",
  "type": "object",
  "properties": {
    "version": { "type": "string", "enum": ["v1"] },
    "domain": { "type": "string", "examples": ["ui.settings", "llm.credentials"] },
    "changed_at": { "type": "string", "format": "date-time" },
    "actor": {
      "type": "object",
      "properties": {
        "tenant": { "type": ["string", "null"] },
        "subject": { "type": ["string", "null"] }
      },
      "additionalProperties": false
    },
    "before": { "type": ["object", "null"] },
    "after": { "type": ["object", "null"] },
    "mask": {
      "type": "object",
      "description": "Masking rules by key (lowercase).",
      "additionalProperties": { "type": "string" }
    },
    "diff_hash": { "type": "string", "description": "Stable hash of the masked diff for dedupe." }
  },
  "required": ["version", "domain", "changed_at", "before", "after"],
  "additionalProperties": false
}
