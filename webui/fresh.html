<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Fresh UI Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a; 
            color: #fff; 
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: #111;
            padding: 1rem 2rem;
            border-bottom: 1px solid #222;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .logo { font-size: 1.25rem; font-weight: 600; }
        .main {
            flex: 1;
            display: flex;
        }
        .sidebar {
            width: 280px;
            background: #111;
            border-right: 1px solid #222;
            padding: 1rem;
        }
        .sidebar h3 { 
            font-size: 0.75rem; 
            text-transform: uppercase; 
            color: #666; 
            margin-bottom: 0.5rem;
        }
        .session-item {
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 0.25rem;
        }
        .session-item:hover { background: #1a1a1a; }
        .session-item.active { background: #222; }
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 2rem;
        }
        .messages {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #666;
        }
        .input-area {
            background: #111;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            gap: 0.5rem;
        }
        .input-area input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 1rem;
            outline: none;
        }
        .input-area button {
            background: #6366f1;
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
        }
        .status {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: #22c55e;
            color: #000;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .btn-clear {
            background: #ef4444;
            color: #fff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <div class="status">âœ“ NEW UI LOADED</div>
    
    <header class="header">
        <div class="logo">ðŸ§  SomaAgent01</div>
        <span style="color: #666; font-size: 0.875rem;">Fresh UI Test - No Cache</span>
        <button class="btn-clear" onclick="clearAllAndRedirect()">Clear Cache & Go to Main UI</button>
    </header>
    
    <main class="main">
        <aside class="sidebar">
            <h3>Sessions</h3>
            <div class="session-item active">New Chat</div>
            <div class="session-item">Previous Session 1</div>
            <div class="session-item">Previous Session 2</div>
        </aside>
        
        <div class="chat-area">
            <div class="messages">
                <p style="font-size: 1.5rem; margin-bottom: 0.5rem;">ðŸ‘‹ Welcome!</p>
                <p>This is the NEW UI. If you see this, your browser is loading fresh content.</p>
                <p style="margin-top: 1rem; font-size: 0.875rem;">Click the red button above to clear cache and go to the main UI.</p>
            </div>
            
            <div class="input-area">
                <input type="text" placeholder="Type a message...">
                <button>Send</button>
            </div>
        </div>
    </main>
    
    <script>
        // Unregister ALL service workers
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                registrations.forEach(reg => {
                    reg.unregister();
                    console.log('Unregistered SW:', reg.scope);
                });
            });
        }
        
        // Clear ALL caches
        if ('caches' in window) {
            caches.keys().then(names => {
                names.forEach(name => {
                    caches.delete(name);
                    console.log('Deleted cache:', name);
                });
            });
        }
        
        // Clear storage
        localStorage.clear();
        sessionStorage.clear();
        
        console.log('âœ… Fresh UI loaded - all caches cleared');
        
        async function clearAllAndRedirect() {
            // Double-clear everything
            if ('serviceWorker' in navigator) {
                const regs = await navigator.serviceWorker.getRegistrations();
                await Promise.all(regs.map(r => r.unregister()));
            }
            if ('caches' in window) {
                const names = await caches.keys();
                await Promise.all(names.map(n => caches.delete(n)));
            }
            localStorage.clear();
            sessionStorage.clear();
            
            // Redirect to main UI with cache-busting
            window.location.href = '/?nocache=' + Date.now();
        }
    </script>
</body>
</html>
