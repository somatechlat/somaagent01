// Enhanced event bus for UI modules with improved architecture, error handling, and performance
import { handleError } from "i18n.t('ui_i18ni18n.t('ui_i18n_t_i18n_t')_t_ui_i18n_t_ui_error_handling_js'i18n.t('ui_api_on_event_handler_i18n_t')'i18n.t('i18n.t('ui_i18n_t_ui_unsubscribe_fn_emit_event_payload_once_event_handler_namespacing_use_dot_notation_e_g_ui_status_progress_wildcard_subscription_not_implemented_for_simplicity_core_event_handlers_storage_with_metadata_const_handlers_new_map_eventname_set')')'i18n.t('ui_fi18n_t')'ui_i18n_t_ui_i18n_t_ui_unsubscribe_fn_emit_event_payload_once_event_handler_namespacing_use_dot_notation_e_g_ui_status_progress_wildcard_subscription_not_implemented_for_simplicity_core_event_handlers_storage_with_metadata_const_handlers_new_map_eventname_set'i18n.t('ui_ig_maxhistorysize_100_enai18n_t')'ui_i18n_t_ui_i18n_t_ui_const_eventhistory_new_map_eventname_array'i18n.t('ui_e_maxhandlersperevent_1000_emittimeout_5000_performance_monitoring_const_performancemetrics_totalemits_0_totalhandlers_0_averageemittime_0_lastemittime_0_enhanced_event_subscription_with_metadata_and_validation_export_function_on_event_fn_options_if_typeof_event')'i18n.t('i18n.t('ui_string')')'i18n.t('ui_event_trim_throw_new_error')'i18n.t('i18n.t('ui_event_name_must_be_a_non_empty_string')')'i18n.t('ui_if_typeof_fn')'i18n.t('i18n.t('ui_function')')'i18n.t('ui_throw_new_error')'i18n.t('i18n.t('ui_handler_must_be_a_function')')'i18n.t('ui_check_handler_limit_per_event_const_existinghandlers_handlers_get_event_if_existinghandlers_existinghandlers_size_config_maxhandlersperevent_console_warn_maximum_handlers_config_maxhandlersperevent_reached_for_event_event_return_return_no_op_unsubscribe_function_if_handlers_has_eventi18n_t')'ui_maximum_handlers_config_maxhandlersperevent_reached_for_event_event'i18n.t('ui_metadata_subscribedat_date_now_callcount_0_lastcalled_null_options_handlers_get_event_add_handlerdata_if_config_enabledebug_debug_event_handler_subscribed_event_handlerdata_metadata_return_unsubscribe_function_with_cleanup_return_off_event_handlerdata_fn_enhanced_event_unsubscription_with_cleanup_export_function_off_event_fn_const_set_handlers_get_event_if_set_find_and_remove_the_specific_handler_for_const_handlerdata_of_set_if_handlerdata_fn_fn_set_delete_handlerdata_if_config_enabledebug_debug_event_handler_unsubscribed_event_handlerdata_metadata_break_clean_up_empty_event_entries_if_set_size_0_handlers_delete_event_eventstats_delete_event_enhanced_one_time_event_subscription_with_error_handling_export_function_once_event_fn_options_let_unsubscribe_const_wrap_payload_try_fn_payload_catch_error_console_error')'i18n.t('i18n.t('ui_event_bus_once_handler_error')')'i18n.t('ui_event_error_throw_error_finally_always_unsubscribe_even_if_handler_throws_if_unsubscribe_unsubscribe_unsubscribe_on_event_wrap_options_once_true_return_unsubscribe_enhanced_event_emission_with_performance_tracking_and_error_handling_export_function_emit_event_payload_const_starttimei18n.t('ui_event_emit_timeout_for_event')ance_now_0_try_if_typeof_event')'i18n.t('i18n.t('ui_string')')'i18n.t('ui_event_trim_throw_new_error')'i18n.t('i18n.t('ui_event_name_must_be_a_non_empty_string')')'i18n.t('ui_update_performance_metrics_performancemetrics_totalemits_const_now_date_now_update_event_statistics_if_eventstats_has_event_eventstats_set_event_emits_0_errors_0_firstemit_now_lastemit_now_const_stats_eventstats_get_event_stats_emits_stats_lastemit_now_add_to_event_history_if_eventhistory_has_event_eventhistory_set_event_const_history_eventhistory_get_event_history_push_timestamp_now_payload_trim_history_if_it_gets_too_large_if_history_length_config_maxhistorysize_history_shift_const_set_handlers_get_event_if_set_set_size_0_create_shallow_copy_for_safe_iteration_during_emit_const_handlerstocall_set_set_up_timeout_for_long_running_handlers_const_timeoutpromise_new_promise_reject_settimeout_reject_new_error_event_emit_timeout_for_event_config_emittimeout_const_emithandlers_async_for_const_hai18n_t')'ui_event_emit_timeout_for_event'i18n.t('ui_try_update_handler_metadata_handlerdata_metadata_callcount_handlerdata_metadata_lastcalled_now_execute_handler_handlerdata_fn_payload_catch_error_stats_errors_use_centralized_error_handling_handleerror_error_component')'i18n.t('i18n.t('ui_eventbus')')'i18n.t('ui_function')'i18n.t('i18n.t('ui_emit')')'i18n.t('ui_event_handler_handlerdata_fn_name')'i18ni18n.t('ui_event_emit_failed_for_event')8n.t('ui_payloadtype_typeof_payload_then_errordata_emit_error_event_if_not_already_handling_an_error_if_event')'i18n.t('i18n.t('ui_eventbus_error')')'i18n.t('ui_emit')'i18n.t('i18n.t('ui_eventbus_error')')'i18n.t('ui_event_errorid_errordata_id_handler_handlerdata_fn_name')'i18n.t('i18n.t('ui_anonymous')')'i18n.t('ui_payload_race_between_handlers_and_timeout_promise_race_emithandlers_timeoutpromise_catch_error_console_error_event_emit_failed_for_event_error_i18n_t')'ui_event_emit_failed_for_event'i18n.t('ui_update_performance_metrics_if_config_enableprofiling_const_emittime_performance_now_starttime_performancemetrics_lastemittime_emittime_performancemetrics_averageemittime_performancemetrics_averageemittime_performancemetrics_totalemits_1_emittime_performancemetrics_totalemits_if_config_enabledebug_debug_event_emitted_event_payload_handlercount_catch_error_handleerror_error_component')'i18n.t('i18n.t('ui_eventbus')')'i18n.t('ui_function')'i18n.t('i18n.t('ui_emit')')'i18n.t('ui_event_severity')'i18n.t('i18n.t('ui_critical')')'i18n.t('ui_then_errordata_emit')'i18n.t('i18n.t('ui_eventbus_critical')')'i18n.t('ui_event_errorid_errordata_id_payload_enhanced_health_introspection_with_detailed_metrics_export_function_listenercount_event_const_set_handlers_get_event_return_set_set_size_0_export_function_events_return_handlers_keys_enhanced_event_history_and_statistics_export_function_geteventhistory_event_limit_10_const_history_eventhistory_get_event_return_history_slice_limit_export_function_geteventstats_event_return_eventstats_get_event_null_export_function_getperformancemetrics_return_performancemetrics_totalevents_handlers_size_totallisteners_handlers_values_reduce_sum_set_sum_set_size_0_memoryusage_handlers_handlers_size_history_eventhistory_size_stats_eventstats_size_utility_functions_for_advanced_event_management_export_function_cleareventhistory_event_if_event_eventhistory_delete_event_else_eventhistory_clear_export_function_removealllisteners_event_if_event_handlers_delete_event_eventstats_delete_event_else_handlers_clear_eventstats_clear_export_function_waitforevent_event_timeout_5000_return_new_promise_resolve_reject_const_timeoutid_settimeout_unsubscribe_reject_new_error_i18n_i18n.t('ui_i18n_t_ui_timeout_waiting_for_event_event')
    }, timeout);

    const unsubscribe = once(event, (payload) => {
      clearTimeout(timeoutId);
      resolve(payload);
    });
  });
}

// Global convenience with enhanced safety
if (!globalThis.eventBus) {
  globalThis.eventBus = { 
    on, off, once, emit, listenerCount, events,
    getEventHistory, getEventStats, getPerformanceMetrics,
    clearEventHistory, removeAllListeners, waitForEvent
  };
}

export default { 
  on, off, once, emit, listenerCount, events,
  getEventHistory, getEventStats, getPerformanceMetrii18n.t('ui_maximum_handlers_config_maxhandlersperevent_reached_for_event_event')nt bus for UI modules with improved architecture, error handling, and performance
import { handleError } from "i18n.t('ui_i18ni18n.t('ui_i18n_t_i18n_t')_t_ui_i18n_t_ui_error_handling_js'i18n.t('ui_api_on_event_handler_i18n_t')'i18n.t('i18n.t('ui_i18n_t_ui_unsubscribe_fn_emit_event_payload_once_event_handler_namespacing_use_dot_notation_e_g_ui_status_progress_wildcard_subscription_not_implemented_for_simplicity_core_event_handlers_storage_with_metadata_const_handlers_new_map_eventname_set')')'i18n.t('ui_fi18n_t')'ui_i18n_t_ui_i18n_t_ui_unsubscribe_fn_emit_event_payload_once_event_handler_namespacing_use_dot_notation_e_g_ui_status_progress_wildcard_subscription_not_implemented_for_simplicity_core_event_handlers_storage_with_metadata_const_handlers_new_map_eventname_set'i18n.t('ui_ig_maxhistorysize_100_enai18n_t')'ui_i18n_t_ui_i18n_t_ui_const_eventhistory_new_map_eventname_array'i18n.t('ui_e_maxhandlersperevent_1000_emittimeout_5000_performance_monitoring_const_performancemetrics_totalemits_0_totalhandlers_0_averageemittime_0_lastemittime_0_enhanced_event_subscription_with_metadata_and_validation_export_function_on_event_fn_options_if_typeof_event')'i18n.t('i18n.t('ui_string')')'i18n.t('ui_event_trim_throw_new_error')'i18n.t('i18n.t('ui_event_name_must_be_a_non_empty_string')')'i18n.t('ui_if_typeof_fn')'i18n.t('i18n.t('ui_function')')'i18n.t('ui_throw_new_error')'i18n.t('i18n.t('ui_handler_must_be_a_function')')'i18n.t('ui_check_handler_limit_per_event_const_existinghandlers_handlers_get_event_if_existinghandlers_existinghandlers_size_config_maxhandlersperevent_console_warn_maximum_handlers_config_maxhandlersperevent_reached_for_event_event_return_return_no_op_unsubscribe_function_if_handlers_has_eventi18n_t')'ui_maximum_handlers_config_maxhandlersperevent_reached_for_event_event'i18n.t('ui_metadata_subscribedat_date_now_callcount_0_lastcalled_null_options_handlers_get_event_add_handlerdata_if_config_enabledebug_debug_event_handler_subscribed_event_handlerdata_metadata_return_unsubscribe_function_with_cleanup_return_off_event_handlerdata_fn_enhanced_event_unsubscription_with_cleanup_export_function_off_event_fn_const_set_handlers_get_event_if_set_find_and_remove_the_specific_handler_for_const_handlerdata_of_set_if_handlerdata_fn_fn_set_delete_handlerdata_if_config_enabledebug_debug_event_handler_unsubscribed_event_handlerdata_metadata_break_clean_up_empty_event_entries_if_set_size_0_handlers_delete_event_eventstats_delete_event_enhanced_one_time_event_subscription_with_error_handling_export_function_once_event_fn_options_let_unsubscribe_const_wrap_payload_try_fn_payload_catch_error_console_error')'i18n.t('i18n.t('ui_event_bus_once_handler_error')')'i18n.t('ui_event_error_throw_error_finally_always_unsubscribe_even_if_handler_throws_if_unsubscribe_unsubscribe_unsubscribe_on_event_wrap_options_once_true_return_unsubscribe_enhanced_event_emission_with_performance_tracking_and_error_handling_export_function_emit_event_payload_const_starttime_config_enableprofiling_performance_now_0_try_if_typeof_event')'i18n.t('i18n.t('ui_string')')'i18n.t('ui_event_trim_throw_new_error')'i18n.t('i18n.t('ui_event_name_must_be_a_non_empty_string')')'i18n.t('ui_update_performance_metrics_performancemetrics_totalemits_const_now_date_now_update_event_statistics_if_eventstats_has_event_eventstats_set_event_emits_0_errors_0_firstemit_now_lastemit_now_const_stats_eventstats_get_event_stats_emits_stats_lastemit_now_add_to_event_history_if_eventhistory_has_event_eventhistory_set_event_const_history_eventhistory_get_event_history_push_timestamp_now_payload_trim_history_if_it_gets_too_large_if_history_length_config_maxhistorysize_history_shift_const_set_handlers_get_event_if_set_set_size_0_create_shallow_copy_for_safe_iteration_during_emit_const_handlerstocall_set_set_up_timeout_for_long_running_handlers_const_timeoutpromise_new_promise_reject_settimeout_reject_new_error_event_emit_timeout_for_event_config_emittimeout_const_emithandlers_async_for_const_hai18n_t')'ui_event_emit_timeout_for_event'i18n.t('ui_try_update_handler_metadata_handlerdata_metadata_callcount_handlerdata_metadata_lastcalled_now_execute_handler_handlerdata_fn_payload_catch_error_stats_errors_use_centralized_error_handling_handleerror_error_component')'i18n.t('i18n.t('ui_eventbus')')'i18n.t('ui_function')'i18n.t('i18n.t('ui_emit')')'i18n.t('ui_event_handler_handlerdata_fn_name')'i18n.t('i18n.t('ui_anonymous')')'i18n.t('ui_payloadtype_typeof_payload_then_errordata_emit_error_event_if_not_already_handling_an_error_if_event')'i18n.t('i18n.t('ui_eventbus_error')')'i18n.t('ui_emit')'i18n.t('i18n.t('ui_eventbus_error')')'i18n.t('ui_event_errorid_errordata_id_handler_handlerdata_fn_name')'i18n.t('i18n.t('ui_anonymous')')'i18n.t('ui_payload_race_between_handlers_and_timeout_promise_race_emithandlers_timeoutpromise_catch_error_console_error_event_emit_failed_for_event_error_i18n_t')'ui_event_emit_failed_for_event'i18n.t('ui_update_performance_metrics_if_config_enableprofiling_const_emittime_performance_now_starttime_performancemetrics_lastemittime_emittime_performancemetrics_averageemittime_performancemetrics_averageemittime_performancemetrics_totalemits_1_emittime_performancemetrics_totalemits_if_config_enabledebug_debug_event_emitted_event_payload_handlercount_catch_error_handleerror_error_component')'i18n.t('i18n.t('ui_eventbus')')'i18n.t('ui_function')'i18n.t('i18n.t('ui_emit')')'i18n.t('ui_event_severity')'i18n.t('i18n.t('ui_critical')')'i18n.t('ui_then_errordata_emit')'i18n.t('i18n.t('ui_eventbus_critical')')'i18n.t('ui_event_errorid_errordata_id_payload_enhanced_health_introspection_with_detailed_metrics_export_function_listenercount_event_const_set_handlers_get_event_return_set_set_size_0_export_function_events_return_handlers_keys_enhanced_event_history_and_statistics_export_function_geteventhistory_event_limit_10_ci18n.t('ui_i18n_t_i18n_t_ui_i18n_t_ui_unsubscribe_fn_emit_event_payload_once_event_handler_namespacing_use_dot_notation_e_g_ui_status_progress_wildcard_subscription_not_implemented_for_simplicity_core_event_handlers_storage_with_metadata_const_handlers_new_map_eventname_set')um_set_size_0_memoryusage_handlers_handlers_size_history_eventhistory_size_stats_eventstats_size_utility_functions_for_advanced_event_management_export_function_cleareventhistory_event_if_event_eventhistory_delete_event_else_eventhistory_clear_export_function_removealllisteners_event_if_event_handlers_delete_event_eventstats_delete_event_else_handlers_clear_eventstats_clear_export_function_waitforevent_event_timeout_5000_return_new_promise_resolve_reject_const_timeoutid_settimeout_unsubscribe_reject_new_error_i18n_t')'ui_timeout_waiting_for_event_event')`));
    }, timeout);

    const unsubscribe = once(event, (payload) => {
      clearTimeout(timeoutId);
      resolve(payload);
    });
  });
}

// Global convenience with enhanced safety
if (!globalThis.eventBus) {
  globalThis.eventBus = { 
    on, off, once, emit, listenerCount, events,
    getEventHistory, getEventStats, getPerformanceMetrics,
    clearEventHistory, removeAllListeners, waitForEvent
  };
}

export default { 
  on, off, once, emit, listenerCount, events,
  getEventHistory, getEventStats, getPerformanceMetrics,
  clearEventHistory, removeAllListeners, waitForEvent
};
