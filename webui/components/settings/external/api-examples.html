<html>

<head>
    <title>Agent Zero External API Examples</title>
</head>

<body>
    <div x-data>
        <p>Agent Zero provides external API endpoints for integration with other applications.</p>
        <p>These endpoints use your signed-in session cookie or an Authorization: Bearer token from Settings, and support text messages and file attachments.</p>

        <!-- API Token Information -->
        <div style="background-color: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: 6px; padding: 12px; margin: 16px 0;">
            <h4 style="margin: 0 0 8px 0; color: var(--color-text-primary);">API Token Information</h4>
            <p style="margin: 0; color: var(--color-text-secondary); font-size: 14px;">
                The API token is automatically generated from your username and password.
                This same token is used for both MCP server connections and external API endpoints.
                The token changes when you update your credentials.
            </p>
        </div>

        <!-- Section 1: /v1/session/message Endpoint -->
        <div class="api-section">
            <h2>POST /v1/session/message</h2>
            <p style="margin: 0 0 16px 0; color: var(--color-text-secondary); font-size: 14px;">
                Send messages to Agent Zero and receive responses. Supports text messages, file attachments, and conversation continuity.
            </p>

            <!-- API Reference -->
            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">API Reference</h3>
            <div style="background-color: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: 6px; padding: 12px; margin: 0 0 20px 0;">
                <p style="margin: 0 0 8px 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Parameters:</strong><br>
                    • <code>session_id</code> (string, optional): Existing chat session ID<br>
                    • <code>message</code> (string, required): The message to send<br>
                    • <code>attachments</code> (array, optional): Array of {filename, base64} objects<br>
                    • <code>lifetime_hours</code> (number, optional): Chat lifetime in hours (default: 24)
                </p>
                <p style="margin: 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Auth:</strong> Uses your session cookie when signed in. For programmatic use, send <code>Authorization: Bearer &lt;jwt&gt;</code>. <br>
                    <strong>Headers:</strong> <code>Content-Type: application/json</code>
                </p>
            </div>

            <!-- JavaScript Examples -->
            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">JavaScript Examples</h3>

            <h4>Basic Usage Example</h4>
            <div id="api-basic-example"></div>

            <h4>Conversation Continuation Example</h4>
            <div id="api-continuation-example"></div>

            <h4>File Attachment Example</h4>
            <div id="api-attachment-example"></div>
        </div>

        <!-- Section 2: /v1/sessions/{id}/history Endpoint -->
        <div class="api-section">
            <h2>GET /v1/sessions/{session_id}/history</h2>
            <p style="margin: 0 0 16px 0; color: var(--color-text-secondary); font-size: 14px;">
                Retrieve log data by context ID, limited to a specified number of entries from the newest.
            </p>

            <!-- API Reference -->
            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">API Reference</h3>
            <div style="background-color: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: 6px; padding: 12px; margin: 0 0 20px 0;">
                <p style="margin: 0 0 8px 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Parameters:</strong><br>
                    • <code>session_id</code> (string, required): Session ID to get history from<br>
                    • <code>limit</code> (integer, optional): Number of items to return (default: 500)
                </p>
                <p style="margin: 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Auth:</strong> Session cookie or <code>Authorization: Bearer</code>
                </p>
            </div>

            <!-- JavaScript Examples -->
            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">JavaScript Examples</h3>

            <h4>GET Request Example</h4>
            <div id="api-log-get-example"></div>
            
        </div>

        <!-- Section 3: /v1/sessions/{id} DELETE Endpoint -->
        <div class="api-section">
            <h2>DELETE /v1/sessions/{session_id}</h2>
            <p style="margin: 0 0 16px 0; color: var(--color-text-secondary); font-size: 14px;">
                Terminate and remove a chat session to free up resources. Similar to the MCP finish_chat function.
            </p>

            <!-- API Reference -->
            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">API Reference</h3>
            <div style="background-color: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: 6px; padding: 12px; margin: 0 0 20px 0;">
                <p style="margin: 0 0 8px 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Parameters:</strong><br>
                    • <code>session_id</code> (string, required): Session ID of the chat to terminate
                </p>
                <p style="margin: 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Auth:</strong> Session cookie or <code>Authorization: Bearer</code>
                </p>
            </div>

            <!-- JavaScript Examples -->
            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">JavaScript Examples</h3>
            <h4>Basic Termination Examples</h4>
            <div id="api-terminate-example"></div>
        </div>

        <!-- Section 4: /v1/sessions/{id}/reset Endpoint -->
        <div class="api-section">
            <h2>POST /v1/sessions/{session_id}/reset</h2>
            <p style="margin: 0 0 16px 0; color: var(--color-text-secondary); font-size: 14px;">
                Reset a chat session to clear conversation history while keeping the session_id alive for continued use.
            </p>

            <!-- API Reference -->
            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">API Reference</h3>
            <div style="background-color: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: 6px; padding: 12px; margin: 0 0 20px 0;">
                <p style="margin: 0 0 8px 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Parameters:</strong><br>
                    • <code>session_id</code> (string, required): Session ID of the chat to reset
                </p>
                <p style="margin: 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Auth:</strong> Session cookie or <code>Authorization: Bearer</code>
                </p>
            </div>

            <!-- JavaScript Examples -->
            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">JavaScript Examples</h3>
            <h4>Basic Reset Examples</h4>
            <div id="api-reset-example"></div>
        </div>

        <!-- Section 5: /v1/workdir/download Endpoint -->
        <div class="api-section">
            <h2>GET /v1/workdir/download?path=...</h2>
            <p style="margin: 0 0 16px 0; color: var(--color-text-secondary); font-size: 14px;">
                Retrieve file contents by absolute path within the agent workdir. Returns the raw file; read as Blob or text in JS. For multiple files, request each path.
            </p>

            <!-- API Reference -->
            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">API Reference</h3>
            <div style="background-color: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: 6px; padding: 12px; margin: 0 0 20px 0;">
                <p style="margin: 0 0 8px 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Parameters:</strong><br>
                    • <code>path</code> (string, required): File path to retrieve (e.g., <code>/a0/tmp/uploads/file.txt</code>)
                </p>
                <p style="margin: 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Auth:</strong> Session cookie or <code>Authorization: Bearer</code>
                </p>
            </div>

            <!-- JavaScript Examples -->
            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">JavaScript Examples</h3>
            <h4>File Retrieval Examples</h4>
            <div id="api-files-get-example"></div>
        </div>

        <!-- Section 6: Additional Endpoints -->
        <!--
        Example template for new endpoint sections:

        <div class="api-section">
            <h2>POST /endpoint_name</h2>
            <p style="margin: 0 0 16px 0; color: var(--color-text-secondary); font-size: 14px;">
                Description of what this endpoint does...
            </p>

            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">API Reference</h3>
            <div style="background-color: var(--color-bg-secondary); border: 1px solid var(--color-border); border-radius: 6px; padding: 12px; margin: 0 0 20px 0;">
                <p style="margin: 0 0 8px 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Parameters:</strong><br>
                    • <code>param_name</code> (type, required/optional): Description
                </p>
                <p style="margin: 0; color: var(--color-text-secondary); font-size: 14px;">
                    <strong>Auth:</strong> Session cookie or <code>Authorization: Bearer</code><br>
                    <strong>Headers:</strong> <code>Content-Type: application/json</code>
                </p>
            </div>

            <h3 style="margin: 20px 0 12px 0; color: var(--color-text-primary);">JavaScript Examples</h3>
            <h4>Example Title</h4>
            <div id="example-id"></div>
        </div>
        -->

        <script>
            setTimeout(() => {
                const url = window.location.origin;

                // Basic usage example
                const basicExample = `// Basic message example
async function sendMessage() {
    try {
        const response = await fetch('${url}/v1/session/message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: "Hello, how can you help me?",
                lifetime_hours: 24
            })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Success!');
            console.log('Session ID:', data.session_id);
            console.log('Event ID:', data.event_id);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Call the function
sendMessage().then(result => {
    if (result) {
        console.log('Message sent successfully!');
    }
});`;

                                // Continuation example
                const continuationExample = `// Continue conversation example
async function continueConversation(sessionId) {
    try {
        const response = await fetch('${url}/v1/session/message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                session_id: sessionId,
                message: "Can you tell me more about that?",
                lifetime_hours: 24
            })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Continuation Success!');
            console.log('Session ID:', data.session_id);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example: First send a message, then continue the conversation
async function fullConversationExample() {
    const firstResult = await sendMessage();
    if (firstResult && firstResult.session_id) {
        await continueConversation(firstResult.session_id);
    }
}

fullConversationExample();`;

                                // Attachment example
                const attachmentExample = `// File attachment example
async function sendWithAttachment() {
    try {
        // Example with text content (convert to base64)
        const textContent = "Hello World from attachment!";
        const base64Content = btoa(textContent);

        const response = await fetch('${url}/v1/session/message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: "Please analyze this file:",
                attachments: [
                    {
                        filename: "document.txt",
                        base64: base64Content
                    }
                ],
                lifetime_hours: 12
            })
        });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ File sent successfully!');
            console.log('Session ID:', data.session_id);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Call the function
sendWithAttachment();`;

                // Log GET example
                const logGetExample = `// Get history (markdown) via GET
async function getHistory(sessionId, limit = 50) {
    try {
        const params = new URLSearchParams({ limit: limit.toString() });
        const response = await fetch(`${url}/v1/sessions/${encodeURIComponent(sessionId)}/history?` + params, { method: 'GET' });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ History retrieved successfully!');
            console.log('Tokens (approx):', data.tokens);
            console.log('Markdown history:\n', data.history.substring(0, 300) + '...');
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example usage
getHistory('00000000-0000-4000-8000-000000000000', 20);`;

                                                // Terminate chat example
                const terminateExample = `// Basic terminate chat function
async function terminateChat(sessionId) {
    try {
        const response = await fetch(`${url}/v1/sessions/${encodeURIComponent(sessionId)}`, { method: 'DELETE' });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Chat deleted successfully!');
            console.log('Status:', data.status);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example 1: Terminate a specific chat
terminateChat('00000000-0000-4000-8000-000000000000');

// Example 2: Complete workflow - send message, then terminate
async function simpleWorkflow() {
    // Send a message
    const result = await sendMessage();

    if (result && result.session_id) {
        console.log('Chat created:', result.session_id);

        // Do some work with the chat...
        // await continueConversation(result.context_id);

        // Clean up when done
        await terminateChat(result.session_id);
        console.log('Chat cleaned up');
    }
}

// Run the workflow
simpleWorkflow();`;

                // Reset chat example
                const resetExample = `// Basic reset chat function
async function resetChat(sessionId) {
    try {
        const response = await fetch(`${url}/v1/sessions/${encodeURIComponent(sessionId)}/reset`, { method: 'POST' });

        const data = await response.json();

        if (response.ok) {
            console.log('✅ Chat reset successfully!');
            console.log('Status:', data.status);
            return data;
        } else {
            console.error('❌ Error:', data.error);
            return null;
        }
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example 1: Reset a specific chat
resetChat('00000000-0000-4000-8000-000000000000');

// Example 2: Reset and continue conversation
async function resetAndContinue() {
    const sessionId = '00000000-0000-4000-8000-000000000000';

    // Reset the chat to clear history
    const resetResult = await resetChat(sessionId);

    if (resetResult) {
        console.log('Chat reset, starting fresh conversation...');

        // Continue with same context_id but fresh history
        const response = await fetch('${url}/v1/session/message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                session_id: sessionId,  // Same session ID
                message: "Hello, this is a fresh start!",
                lifetime_hours: 24
            })
        });

        const data = await response.json();
        console.log('New message enqueued. Session ID:', data.session_id);
    }
}

// Run the example
resetAndContinue();`;

                // Files get example
                const filesGetExample = `// Basic file retrieval
async function getFile(path) {
    try {
        const response = await fetch(`${url}/v1/workdir/download?` + new URLSearchParams({ path }), { method: 'GET' });
        if (!response.ok) {
            console.error('❌ Error:', await response.text());
            return null;
        }
        const blob = await response.blob();
        const text = await blob.text();
        console.log('✅ File retrieved successfully! First 100 chars:', text.substring(0, 100) + '...');
        return text;
    } catch (error) {
        console.error('❌ Request failed:', error);
        return null;
    }
}

// Example: Get a specific file
getFile('/a0/tmp/uploads/document.txt');

// Example 2: Complete attachment workflow
async function attachmentWorkflow() {
    // Step 1: Send message with attachments
    const messageResponse = await fetch('${url}/v1/session/message', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            message: "Please analyze this file",
            attachments: [{
                filename: "test.txt",
                base64: btoa("Hello, this is test content!")
            }],
            lifetime_hours: 1
        })
    });

    if (messageResponse.ok) {
        console.log('Message sent with attachment');

        // Step 2: Retrieve the uploaded file (known path)
        const retrieved = await getFile('/a0/tmp/uploads/test.txt');
        if (retrieved) console.log('Retrieved content:', retrieved);
    }
}

// Run the complete workflow
attachmentWorkflow();`;

                // Initialize ACE editors
                const editors = [
                    { id: "api-basic-example", content: basicExample },
                    { id: "api-continuation-example", content: continuationExample },
                    { id: "api-attachment-example", content: attachmentExample },
                    { id: "api-log-get-example", content: logGetExample },
                    { id: "api-terminate-example", content: terminateExample },
                    { id: "api-reset-example", content: resetExample },
                    { id: "api-files-get-example", content: filesGetExample }
                ];

                editors.forEach(({ id, content }) => {
                    const editor = ace.edit(id);
                    const dark = localStorage.getItem("darkMode");
                    if (dark != "false") {
                        editor.setTheme("ace/theme/github_dark");
                    } else {
                        editor.setTheme("ace/theme/tomorrow");
                    }
                    editor.session.setMode("ace/mode/javascript");
                    editor.setValue(content);
                    editor.clearSelection();
                    editor.setReadOnly(true);
                });
            }, 0);
        </script>
    </div>

    <style>
        #api-basic-example,
        #api-continuation-example,
        #api-attachment-example,
        #api-log-get-example,
        #api-terminate-example,
        #api-reset-example,
        #api-files-get-example {
            width: 100%;
            height: 20em;
            margin: 8px 0 16px 0;
            border-radius: 4px;
        }

        /* Section styling */
        .api-section {
            border: 1px solid var(--color-border);
            border-radius: 8px;
            margin: 20px 0;
            padding: 16px;
        }

        .api-section h2 {
            margin: 0 0 16px 0;
            color: var(--color-text-primary);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 8px;
        }

        .api-section h3 {
            margin: 20px 0 12px 0;
            color: var(--color-text-primary);
            font-size: 1.2em;
        }

        .api-section h4 {
            margin: 16px 0 8px 0;
            color: var(--color-text-primary);
        }
    </style>

</body>

</html>
