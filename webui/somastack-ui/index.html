<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SomaAgent01 - Dashboard</title>
  
  <!-- SomaStack UI Styles -->
  <link rel="stylesheet" href="css/somastack-tokens.css">
  <link rel="stylesheet" href="css/somastack-base.css">
  <link rel="stylesheet" href="css/somastack-utilities.css">
  <link rel="stylesheet" href="css/somastack-components.css">
</head>
<body x-data="{ sidebarCollapsed: false }">
  <!-- Skip Link -->
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <!-- Toast Container -->
  <div x-data="toastContainer" class="toast-container">
    <template x-for="toast in toasts" :key="toast.id">
      <div class="toast"
           :class="'toast--' + toast.variant"
           x-show="toast.visible"
           x-transition>
        <span class="toast__icon" x-html="getIcon(toast.variant)"></span>
        <span class="toast__message" x-text="toast.message"></span>
        <button @click="dismiss(toast.id)" class="toast__close">√ó</button>
      </div>
    </template>
  </div>

  <!-- Layout -->
  <div class="layout" :class="{ 'layout--collapsed': sidebarCollapsed }">
    
    <!-- Sidebar -->
    <nav x-data="sidebarNav({
      navGroups: [
        {
          id: 'main',
          label: 'Main',
          items: [
            { id: 'dashboard', label: 'Dashboard', href: '#dashboard', icon: 'üìä' },
            { id: 'conversations', label: 'Conversations', href: '#conversations', icon: 'üí¨', badge: 3 },
            { id: 'memory', label: 'Memory', href: '#memory', icon: 'üß†' }
          ]
        },
        {
          id: 'tools',
          label: 'Tools',
          items: [
            { id: 'browser', label: 'Browser', href: '#browser', icon: 'üåê' },
            { id: 'terminal', label: 'Terminal', href: '#terminal', icon: '‚å®Ô∏è' },
            { id: 'files', label: 'Files', href: '#files', icon: 'üìÅ' }
          ]
        },
        {
          id: 'admin',
          label: 'Admin',
          items: [
            { id: 'settings', label: 'Settings', href: '#settings', icon: '‚öôÔ∏è' },
            { id: 'users', label: 'Users', href: '#users', icon: 'üë•' }
          ]
        }
      ]
    })" 
         class="sidebar"
         :class="{ 'sidebar--collapsed': sidebarCollapsed }">
      
      <div class="sidebar__header">
        <div class="sidebar__logo">
          <span class="sidebar__logo-icon">S</span>
          <span class="sidebar__logo-text" x-show="!sidebarCollapsed">SomaAgent</span>
        </div>
        <button @click="sidebarCollapsed = !sidebarCollapsed" class="sidebar__toggle" aria-label="Toggle sidebar">
          <span x-show="!sidebarCollapsed">‚óÄ</span>
          <span x-show="sidebarCollapsed">‚ñ∂</span>
        </button>
      </div>
      
      <div class="sidebar__content">
        <template x-for="group in navGroups" :key="group.id">
          <div class="nav-group">
            <span class="nav-group__label" x-text="group.label"></span>
            <template x-for="item in group.items" :key="item.id">
              <a :href="item.href"
                 class="nav-item"
                 :class="{ 'nav-item--active': isActive(item) }"
                 @click="navigate(item)">
                <span class="nav-item__icon" x-text="item.icon"></span>
                <span class="nav-item__label" x-text="item.label"></span>
                <span x-show="item.badge" class="nav-item__badge" x-text="item.badge"></span>
              </a>
            </template>
          </div>
        </template>
      </div>
      
      <div class="sidebar__footer">
        <div class="status" x-data="statusIndicator({ service: 'somaagent' })">
          <span class="status__dot" :class="dotClass"></span>
          <span class="status__label" x-show="!sidebarCollapsed">System</span>
          <span class="status__time" x-show="!sidebarCollapsed" x-text="lastCheckedFormatted"></span>
        </div>
      </div>
    </nav>
    
    <!-- Header -->
    <header class="header">
      <h1 class="header__title">Dashboard</h1>
      
      <div class="header__actions">
        <!-- Theme Toggle -->
        <button @click="$store.theme.toggle()" 
                class="btn btn--ghost btn--icon"
                :aria-label="$store.theme.isDark ? 'Switch to light mode' : 'Switch to dark mode'">
          <span x-show="$store.theme.isDark">‚òÄÔ∏è</span>
          <span x-show="!$store.theme.isDark">üåô</span>
        </button>
        
        <!-- User Badge -->
        <span class="badge badge--default" x-text="$store.auth.role"></span>
      </div>
    </header>
    
    <!-- Main Content -->
    <main id="main-content" class="main">
      <div class="main__container">
        
        <!-- Stats Section -->
        <section class="section">
          <h2 class="section__title">Overview</h2>
          
          <div class="stats-grid">
            <div x-data="statsCard({ value: 1247, previousValue: 1100, label: 'Active Sessions' })" 
                 class="stats-card">
              <div class="stats-card__header">
                <span class="stats-card__label" x-text="label"></span>
                <span class="stats-card__icon">üë•</span>
              </div>
              <span class="stats-card__value" x-text="formattedValue"></span>
              <div class="stats-card__trend" :class="trendClass">
                <span x-text="trendIcon"></span>
                <span x-text="trendPercent + '%'"></span>
              </div>
            </div>
            
            <div x-data="statsCard({ value: 89.5, previousValue: 85.2, label: 'Success Rate', format: 'percent' })" 
                 class="stats-card">
              <div class="stats-card__header">
                <span class="stats-card__label" x-text="label"></span>
                <span class="stats-card__icon">‚úÖ</span>
              </div>
              <span class="stats-card__value" x-text="formattedValue"></span>
              <div class="stats-card__trend" :class="trendClass">
                <span x-text="trendIcon"></span>
                <span x-text="trendPercent + '%'"></span>
              </div>
            </div>
            
            <div x-data="statsCard({ value: 2450000, previousValue: 2100000, label: 'Memories Stored' })" 
                 class="stats-card">
              <div class="stats-card__header">
                <span class="stats-card__label" x-text="label"></span>
                <span class="stats-card__icon">üß†</span>
              </div>
              <span class="stats-card__value" x-text="formattedValue"></span>
              <div class="stats-card__trend" :class="trendClass">
                <span x-text="trendIcon"></span>
                <span x-text="trendPercent + '%'"></span>
              </div>
            </div>
            
            <div x-data="statsCard({ value: 145, previousValue: 180, label: 'Avg Response (ms)', format: 'duration' })" 
                 class="stats-card">
              <div class="stats-card__header">
                <span class="stats-card__label" x-text="label"></span>
                <span class="stats-card__icon">‚ö°</span>
              </div>
              <span class="stats-card__value" x-text="formattedValue"></span>
              <div class="stats-card__trend" :class="trendClass">
                <span x-text="trendIcon"></span>
                <span x-text="trendPercent + '%'"></span>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Service Status -->
        <section class="section">
          <h2 class="section__title">Service Status</h2>
          
          <div class="card">
            <div class="card__body">
              <div class="flex gap-8">
                <div x-data="statusIndicator({ service: 'somaagent' })" class="status">
                  <span class="status__dot" :class="dotClass"></span>
                  <span class="status__label">SomaAgent</span>
                </div>
                
                <div x-data="statusIndicator({ service: 'somabrain' })" class="status">
                  <span class="status__dot" :class="dotClass"></span>
                  <span class="status__label">SomaBrain</span>
                </div>
                
                <div x-data="statusIndicator({ service: 'somamemory' })" class="status">
                  <span class="status__dot" :class="dotClass"></span>
                  <span class="status__label">SomaMemory</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Recent Conversations Table -->
        <section class="section">
          <h2 class="section__title">Recent Conversations</h2>
          
          <div x-data="dataTable({
            columns: [
              { key: 'id', label: 'ID', sortType: 'string' },
              { key: 'user', label: 'User', sortType: 'string' },
              { key: 'topic', label: 'Topic', sortType: 'string' },
              { key: 'status', label: 'Status', type: 'status' },
              { key: 'messages', label: 'Messages', sortType: 'number' },
              { key: 'created', label: 'Created', sortType: 'date' }
            ],
            data: [
              { id: 'conv-001', user: 'alice@example.com', topic: 'Code Review', status: 'approved', messages: 12, created: '2025-12-22T10:30:00' },
              { id: 'conv-002', user: 'bob@example.com', topic: 'Bug Investigation', status: 'pending', messages: 8, created: '2025-12-22T09:15:00' },
              { id: 'conv-003', user: 'carol@example.com', topic: 'Feature Request', status: 'approved', messages: 24, created: '2025-12-21T16:45:00' },
              { id: 'conv-004', user: 'dave@example.com', topic: 'Documentation', status: 'rejected', messages: 3, created: '2025-12-21T14:20:00' },
              { id: 'conv-005', user: 'eve@example.com', topic: 'Performance Tuning', status: 'pending', messages: 15, created: '2025-12-21T11:00:00' }
            ],
            pageSize: 10
          })" class="table-container">
            
            <div class="table__toolbar">
              <input type="search" 
                     x-model="searchQuery"
                     placeholder="Search conversations..."
                     class="input input--search"
                     style="max-width: 300px;">
              
              <button class="btn btn--primary" @click="$toast.success('New conversation started!')">
                + New Conversation
              </button>
            </div>
            
            <table class="table">
              <thead>
                <tr>
                  <th class="table__checkbox">
                    <input type="checkbox" 
                           class="checkbox__input"
                           :checked="allSelected"
                           :indeterminate="someSelected"
                           @change="toggleSelectAll()">
                  </th>
                  <template x-for="col in columns" :key="col.key">
                    <th @click="sortBy(col.key)" 
                        class="table__header"
                        :class="{ 'table__header--sorted': sortColumn === col.key }">
                      <span x-text="col.label"></span>
                      <span x-show="sortColumn === col.key" x-text="sortDirection === 'asc' ? ' ‚Üë' : ' ‚Üì'"></span>
                    </th>
                  </template>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <template x-if="isLoading">
                  <tr>
                    <td :colspan="columns.length + 2" class="p-6 text-center">
                      <div class="spinner"></div>
                    </td>
                  </tr>
                </template>
                
                <template x-if="!isLoading && isEmpty">
                  <tr>
                    <td :colspan="columns.length + 2" class="table__empty">
                      <div class="table__empty-icon">üì≠</div>
                      <p>No conversations yet</p>
                    </td>
                  </tr>
                </template>
                
                <template x-if="!isLoading && noResults">
                  <tr>
                    <td :colspan="columns.length + 2" class="table__empty">
                      <div class="table__empty-icon">üîç</div>
                      <p>No results found for "<span x-text="searchQuery"></span>"</p>
                    </td>
                  </tr>
                </template>
                
                <template x-for="row in paginatedData" :key="row.id">
                  <tr class="table__row" :class="{ 'table__row--selected': isSelected(row.id) }">
                    <td class="table__checkbox">
                      <input type="checkbox" 
                             class="checkbox__input"
                             :checked="isSelected(row.id)"
                             @change="toggleSelect(row.id)">
                    </td>
                    <template x-for="col in columns" :key="col.key">
                      <td>
                        <template x-if="col.type === 'status'">
                          <span class="badge" :class="'badge--' + row[col.key]" x-text="row[col.key]"></span>
                        </template>
                        <template x-if="col.type !== 'status'">
                          <span x-text="row[col.key]"></span>
                        </template>
                      </td>
                    </template>
                    <td class="table__actions">
                      <button class="btn btn--ghost btn--sm">View</button>
                      <button class="btn btn--ghost btn--sm">Edit</button>
                      <button class="btn btn--ghost btn--sm text-error">Delete</button>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
            
            <div class="table__pagination" x-show="showPagination">
              <span x-text="'Showing ' + startIndex + '-' + endIndex + ' of ' + totalItems"></span>
              <div class="flex gap-2">
                <button @click="prevPage()" 
                        :disabled="currentPage === 1"
                        class="btn btn--ghost btn--sm">
                  ‚Üê Prev
                </button>
                <span class="px-4 py-2" x-text="currentPage + ' / ' + totalPages"></span>
                <button @click="nextPage()" 
                        :disabled="currentPage === totalPages"
                        class="btn btn--ghost btn--sm">
                  Next ‚Üí
                </button>
              </div>
            </div>
          </div>
        </section>
        
      </div>
    </main>
    
  </div>
  
  <!-- Mobile Bottom Nav -->
  <nav class="bottom-nav">
    <a href="#dashboard" class="bottom-nav__item bottom-nav__item--active">
      <span>üìä</span>
      <span>Dashboard</span>
    </a>
    <a href="#conversations" class="bottom-nav__item">
      <span>üí¨</span>
      <span>Chat</span>
    </a>
    <a href="#memory" class="bottom-nav__item">
      <span>üß†</span>
      <span>Memory</span>
    </a>
    <a href="#settings" class="bottom-nav__item">
      <span>‚öôÔ∏è</span>
      <span>Settings</span>
    </a>
  </nav>

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  
  <!-- SomaStack UI Scripts -->
  <script src="js/stores/auth-store.js"></script>
  <script src="js/stores/theme-store.js"></script>
  <script src="js/stores/status-store.js"></script>
  <script src="js/components/sidebar-nav.js"></script>
  <script src="js/components/stats-card.js"></script>
  <script src="js/components/data-table.js"></script>
  <script src="js/components/modal.js"></script>
  <script src="js/components/toast.js"></script>
  <script src="js/components/status-indicator.js"></script>
  
  <script>
    // Initialize stores after Alpine loads
    document.addEventListener('alpine:init', () => {
      // Add sidebar store for layout
      Alpine.store('sidebar', {
        isCollapsed: false,
        toggle() {
          this.isCollapsed = !this.isCollapsed;
        }
      });
    });
    
    // Start status polling after page load
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        if (Alpine.store('status')) {
          Alpine.store('status').startPolling();
        }
      }, 100);
    });
  </script>
</body>
</html>
